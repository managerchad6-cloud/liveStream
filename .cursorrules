# Cursor Rules for LiveStream Chatbox

## Windows Compatibility Mode

This project must work on both Linux (VPS) and Windows (local development).

### Critical Rules

1. **Always use `path.join()` or `path.resolve()` for file paths** - Never concatenate paths with `/` or `\`
2. **Manifest paths use Unix-style `/`** - This is intentional for cross-platform compatibility
3. **When reading manifest paths** - Split by `/` and rejoin with `path.join()`
4. **FFmpeg paths must be platform-aware** - Check `animation-server/platform.js`
5. **No hardcoded `/tmp/` paths** - Use `os.tmpdir()` or project scratchpad

### Reference Files

- `CURSOR_PROMPT.md` - Detailed Windows compatibility guide
- `WINDOWS_QUICKSTART.md` - User quick-start guide
- `WINDOWS_DEPLOYMENT_GUIDE.md` - Comprehensive troubleshooting
- `CLAUDE.md` - Full project documentation

### Key Files to Understand

- `tools/export-psd.js:92` - Exports manifest with Unix paths (correct)
- `animation-server/compositor.js:181` - Converts manifest paths to platform paths (correct)
- `animation-server/compositor.js` - `sharp.concurrency(2)` for libvips thread pool
- `animation-server/platform.js` - Platform-specific binary paths
- `vps-setup/animation.service` - `UV_THREADPOOL_SIZE=4`, `ANIMATION_PORT=3003`

### Test Commands

```bash
npm run export-psd      # Export PSD layers
npm run verify-export   # Verify export (should show all âœ“)
npm run animation       # Start animation server (should load 62 layers)
npm start               # Start chat server
```

### Don't Break These

- Manifest.json format (Unix-style paths are intentional)
- Linux/VPS compatibility (it's working perfectly)
- Cross-platform path handling patterns in compositor.js and export-psd.js
